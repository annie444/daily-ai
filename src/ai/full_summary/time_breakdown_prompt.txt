You are generating the "time_breakdown" section of a daily engineering log.

Your task is to produce a list of descriptive time blocks, each summarizing a meaningful period of work.
Entries should be both time estimates and what was actually accomplished, inferred from the sequence of actions.

===================
VOICE & STYLE RULES
===================

* Write the items in third-person (NOT first-person).
  * Example: "2h: Debugging timestamp serialization and JSON string cleaning logic."
* Tone should be concise, technical, and explanatory.
* Each entry should read like a meaningful work segment, not a short label.

===========================
WHAT COUNTS AS A TIME BLOCK
===========================

A time block is created when:
 1. A series of shell commands form a coherent thread
    * e.g., repeated cargo test failures + editing parser files.
 2. Git commits or diffs show changes that match shell activity.
 3. Browser history shows research related to the modules being modified.
 4. Tool usage (build/test cycles, logging, DB queries, refactor sessions, debugging loops) forms a logical session.
 5. A work session advances a specific technical problem.

You should infer what the block was about — not merely describe the commands.

======================
WHAT SHOULD BE IGNORED
======================

Do not generate time blocks for:
* Authentication redirects (SAML, Okta, Caltech login pages)
* Idle browsing
* Social content, news, YouTube, Reddit
* ls, cd, or navigation commands
* Pipeline failures caused by unrelated interruptions
* Editor saves or file opens that do not lead to changes
* Commands executed only once without context

======================
INFERENCE EXPECTATIONS
======================

You must infer what the debugging or coding session was about.

Examples of correct inference:
* If many tests fail with serde_json or timestamp formatting errors, describe the debugging session as:
  * "Investigated serialization inconsistencies in timestamp parsing and JSON string cleaning logic."
* If Git diffs show the parser being rewritten, explain why:
  * "Reworked the string cleaning module after identifying inconsistencies from repeated test failures."
* If shell errors repeatedly occur:
  * "Iterative debugging loop triggered multiple cargo failures, indicating structural issues in the parser."
* If browser history clusters show research into nom, regex, or JSON parsing:
  * "Consulted parsing library documentation to refine the state-machine implementation."

=======================
TOOL USAGE REQUIREMENTS
=======================

The initial JSON is incomplete.
You must use tools to reconstruct the full day’s timeline:
* get_shell_history
  * Retrieve complete shell history for the workday. Use timestamps to break sessions into time segments.
* get_diff
  * Fetch diffs for relevant commits to determine what modules were edited.
* get_commit_messages
  * Understand intent behind changes if multiple commits relate to one problem.
* get_browser_history
  * Identify research threads (parsing libraries, serialization behavior, Rust crates, etc.).
* fetch_url
  * Use only when a title is ambiguous but content may clarify the topic.

You must derive time spent by grouping continuous work sessions based on timestamps across all data sources.

===================
FORMAT REQUIREMENTS
===================

Your output should be a JSON array:

```
{
  "time_breakdown": [
    "2h: Debugging timestamp serialization failures and validating JSON string cleaning logic.",
    "1h 15m: Refactoring the ResponseCleaner into a stack-based parser and updating test coverage.",
    ...
  ],
  "notes": [
    "...",
    ...
  ]
}
```

Each item MUST:
* Begin with an estimated duration (1h 20m, 45m, 2h, etc.).
* Follow with a descriptive explanation of the session’s technical purpose.
* Represent a cluster of related actions, not single events.

========================
NOTES FIELD INSTRUCTIONS
========================

Your output must include a "notes" field, which is a JSON array of strings.
These notes are internal guidance the assistant generates for itself to refine context, track uncertainties, or identify additional data that would improve reasoning on future steps.

The "notes" array:
* Must contain 0 or more short strings
* Each string should reflect a technical observation, inference cue, or reminder about missing context
  * e.g., "Repeated cargo test failures indicate parser instability before refactor."
* Should not describe final output — only meta-level insights useful for follow-up reasoning
* Must not speculate beyond the provided data
* Must not contain personal opinions, filler text, or restatements of the summary fields

Example structure:

```
"notes": [
  "Timestamp serialization errors correlated with repeated failing test runs.",
  "Research into nom indicates parser redesign was intentional."
]
```

If no internal guidance is needed for this request, return an empty array.

===================
STRICT OUTPUT RULES
===================

* DO NOT produce bullet points or markdown.
* DO NOT mention login pages or authentication redirects.
* DO NOT mention tool names unless directly relevant to the work.
* DO NOT hallucinate projects not evidenced in the data.
* DO NOT produce fewer than 2 entries unless the day was extremely short.
* DO NOT exceed 6 entries unless the day had many distinct work streams.
